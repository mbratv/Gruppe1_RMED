-------
# Group 1 Project
Title: "RMED901_Group1_Project_110923"
Authors: "Marianne Br√•tveit, Eline Hillestad, Ryan Dunkel and Jonathan Chambenoit"
Date: "2023-09-11"
Output: html_document

-----
#Day 5 - Reading, exploring, tidying and exploring data

#Importing packages
```{r}
library(tidyverse)
library(here)

here()
data <- read_delim(here("Data", "exam_data.txt")) #Assigning the dataset to an object "data".
data

```

## Final tidy data at the end of Day 5
```{r}
tidy_data <- data %>% rename(BMI = "BMI kg/m2", # Renaming columns 
                Attempts = "# attempts",
                Failures = "# failures") %>% 
  distinct() %>% # Removing duplicates
  pivot_wider(names_from = difficulties_intubating_feature, 
              values_from = difficulties_intubating_value) %>% 
  # Creating three new columns by pivoting wider 
  separate(col = last_method_S_F,
           into = c("last_method", "last_method_S_F"),
           sep = "_") %>% # Splitting the last_method_S_F column into two different columns
  mutate(last_method_S_F = as.double(last_method_S_F),
         last_method = as.double(last_method)) #Converting these two columns to numeric columns as they were turned into character columns when splitting them
  
```

# Day 6
## Removing the uncessesarry rows "month" and "year"

```{r}
og_data <- tidy_data %>% select(-c(month, year)) # Removing the columns month and year 
 
```
## Adding the additional dataset to our environment
```{r}
ad_df <- read_delim(here("Data", "exam_data_join.txt")) # Importing the additional dataset and assigning it to an object
```

## Joining the two datasets
```{r}
joined_df <- og_data %>% 
  left_join(ad_df, by = "id") %>%  # Deciding to join the original dataframe to the ad_df by the column "id" as this is present in both datasets
  distinct() %>% # Removing duplicates
 mutate(gender = if_else(gender == 0, "Female", "Male"), # Could also have used the function case_when like this: mutate(gender =case_when(gender == "0" ~ "Female", gender == "1" ~ "Male"))
        Mallampati_asa = (asa*Mallampati), # Adding a column multiplicating the columns asa and Mallampati ) # Changing the column gender to character observations
        Ease_quartile = cut(ease, breaks = 4), # Creating a new column with quartile-values for the ease-column 
        Method_check = ifelse(last_method == Randomization, "True", "False")) %>%  # Creating a new column that checks whether the column "last method" contains the same values as the column "Randomization) 

  select(id, gender, age, BMI, everything()) %>%  #Changing the order of the columns so that gender is at the beginning of the dataset. 
  arrange(id) #%>%  # The id's in our dataset are already in increasing order, but we could have used the code arrange(desc(id)) if we wanted to change them into descending order. 

```

## Checking for missing values in the dataset. 
```{r}
joined_df %>% summarise(across(everything(), ~sum(is.na(.)))) # There are 2 missing values for BMI,  1 for sore_throat, 1 for mallampati and 1 for mallampati_asa
```

## Stratifying the dataset for a categorical column (chose the column gender) and reporting min, max, mean and sd of a numeric column (chose the column total_intubation_time)
```{r}
joined_df %>% 
  group_by(gender) %>% 
  summarise(
    min_total_intubation_time = min(total_intubation_time, na.rm = T),  #It is possible to use na.rm = T instead of writing TRUE (it does the same)
    max_total_intubation_time = max(total_intubation_time, na.rm = T),
    mean_total_intubation_time = mean(total_intubation_time, na.rm = T),
    sd_total_intubation_time = sd(total_intubation_time, na.rm = T))
```

### Only for persons with BMI <= 40
```{r}
joined_df %>% 
  group_by(gender) %>% 
  filter(BMI <= 40) %>% 
   summarise(
    min_total_intubation_time = min(total_intubation_time, na.rm = T),
    max_total_intubation_time = max(total_intubation_time, na.rm = T),
    mean_total_intubation_time = mean(total_intubation_time, na.rm = T),
    sd_total_intubation_time = sd(total_intubation_time, na.rm = T))
```

### Only for females
```{r}
joined_df %>% 
  group_by(Randomization) %>% 
  filter(gender == "Female") %>% 
   summarise(
    min_total_intubation_time = min(total_intubation_time, na.rm = T),
    max_total_intubation_time = max(total_intubation_time, na.rm = T),
    mean_total_intubation_time = mean(total_intubation_time, na.rm = T),
    sd_total_intubation_time = sd(total_intubation_time, na.rm = T))
```

### Only for those above the age of 45
```{r}
joined_df %>% 
  group_by(Attempts) %>% 
  filter(age > 45) %>% 
   summarise(
    min_total_intubation_time = min(total_intubation_time, na.rm = T),
    max_total_intubation_time = max(total_intubation_time, na.rm = T),
    mean_total_intubation_time = mean(total_intubation_time, na.rm = T),
    sd_total_intubation_time = sd(total_intubation_time, na.rm = T))
```

### Only for those with mallampati score above or equal to 2
```{r}
joined_df %>% 
  group_by(Failures) %>% 
  filter(Mallampati >= 2) %>% 
   summarise(
    min_total_intubation_time = min(total_intubation_time, na.rm = T),
    max_total_intubation_time = max(total_intubation_time, na.rm = T),
    mean_total_intubation_time = mean(total_intubation_time, na.rm = T),
    sd_total_intubation_time = sd(total_intubation_time, na.rm = T))
```

## Used two categorical columns in our dataset to create a table:
```{r}
CC_table <- joined_df %>%
  count(gender, Attempts)
```

